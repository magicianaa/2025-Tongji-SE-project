# ç¬¬ä¸€é˜¶æ®µ ä»»åŠ¡1.1 & 1.2 å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ¦‚è§ˆ

**ä»»åŠ¡æ—¶é—´**ï¼š2025-12-16  
**æ‰§è¡Œé˜¶æ®µ**ï¼šPhase 1 - æ¶æ„åŸºç¡€é‡æ„  
**ä»»åŠ¡å†…å®¹**ï¼šå‰ç«¯è§†å›¾æ‹†åˆ† + RBACæƒé™æ§åˆ¶  
**æ‰§è¡ŒçŠ¶æ€**ï¼šâœ… **å·²å®Œæˆ**

---

## âœ… å®Œæˆæ¸…å•

### ä»»åŠ¡1.1ï¼šå‰ç«¯æ¶æ„é‡æ„ï¼ˆè§†å›¾æ‹†åˆ†ï¼‰

#### 1. åˆ›å»ºä¸‰å¥—Layoutç»„ä»¶
- âœ… `frontend/src/layouts/AdminLayout.vue` - ç®¡ç†ç«¯å¸ƒå±€ï¼ˆç´«è‰²ä¸»é¢˜ï¼‰
  - å¯¼èˆªèœå•ï¼šæ•°æ®çœ‹æ¿ã€è¿è¥æŠ¥è¡¨ã€å‘˜å·¥ç®¡ç†ã€ç³»ç»Ÿé…ç½®
  - ç”¨æˆ·ä¸‹æ‹‰èœå•ï¼šä¸ªäººèµ„æ–™ã€é€€å‡ºç™»å½•
  
- âœ… `frontend/src/layouts/StaffLayout.vue` - å‰å°ç«¯å¸ƒå±€ï¼ˆç»¿è‰²ä¸»é¢˜ï¼‰
  - å¯¼èˆªèœå•ï¼šå·¥ä½œå°ã€æˆ¿æ€ç®¡ç†ã€ç¡¬ä»¶ç›‘æ§ã€POSè®¢å•ã€ç»´ä¿®å·¥å•ã€ä»»åŠ¡å®¡æ ¸
  - ç”¨æˆ·ä¸‹æ‹‰èœå•ï¼šä¸ªäººèµ„æ–™ã€é€€å‡ºç™»å½•
  
- âœ… `frontend/src/layouts/GuestLayout.vue` - ä½å®¢ç«¯å¸ƒå±€ï¼ˆç´«è“ä¸»é¢˜ï¼‰
  - å¯¼èˆªèœå•ï¼šé¦–é¡µã€é¢„è®¢æˆ¿é—´ã€å•†åŸç‚¹é¤*ã€ç¤¾äº¤å¤§å…*ã€ä»»åŠ¡ç§¯åˆ†*ã€è®¾å¤‡æŠ¥ä¿®*ã€é€€æˆ¿ç»“ç®—*
  - (*æ ‡è®°çš„åŠŸèƒ½éœ€è¦äºŒæ¬¡é‰´æƒroomAuthTokenï¼Œå°†åœ¨Phase 2å®ç°)
  - é¡¶éƒ¨æ˜¾ç¤ºæˆ¿é—´ç»‘å®šçŠ¶æ€å¾½ç« 

#### 2. åˆ›å»ºè§’è‰²ç›®å½•ç»“æ„
```
frontend/src/views/
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ Dashboard.vue (ç®¡ç†çœ‹æ¿ï¼šè¥æ”¶ã€å…¥ä½ç‡ã€è®¢å•ã€å®¢äººç»Ÿè®¡)
â”œâ”€â”€ staff/
â”‚   â”œâ”€â”€ Workbench.vue (å‰å°å·¥ä½œå°ï¼ŒåŸHome.vueç§»åŠ¨è€Œæ¥)
â”‚   â”œâ”€â”€ RoomManagement.vue (æˆ¿æ€ç®¡ç†ï¼Œå·²ç§»åŠ¨)
â”‚   â””â”€â”€ HardwareMonitor.vue (ç¡¬ä»¶ç›‘æ§ï¼Œå·²ç§»åŠ¨) â­ï¸
â”œâ”€â”€ guest/
â”‚   â”œâ”€â”€ Home.vue (ä½å®¢é¦–é¡µï¼ŒæœåŠ¡å¡ç‰‡å±•ç¤º)
â”‚   â””â”€â”€ Booking.vue (é¢„è®¢æˆ¿é—´ï¼Œæ—¥æœŸé€‰æ‹©)
â””â”€â”€ Login.vue (ç™»å½•æ³¨å†Œï¼Œä¿æŒåœ¨æ ¹ç›®å½•)
```

#### 3. ç¡¬ä»¶ç›‘æ§ä»£ç è¿ç§»
- âœ… åŸ `views/HardwareMonitor.vue` å·²ç§»åŠ¨åˆ° `views/staff/HardwareMonitor.vue`
- âœ… ä»£ç å®Œæ•´ä¿ç•™ï¼ŒåŒ…æ‹¬WebSocketè¿æ¥å’Œå®æ—¶æ•°æ®æ›´æ–°é€»è¾‘
- âœ… è·¯ç”±æ›´æ–°ä¸º `/staff/hardware`

---

### ä»»åŠ¡1.2ï¼šé‰´æƒä¸RBACä¿®å¤

#### 1. åç«¯è§’è‰²å­—æ®µéªŒè¯
- âœ… `User.java` å®ä½“åŒ…å« `userType` å­—æ®µï¼ˆç±»å‹ï¼šStringï¼‰
- âœ… æ”¯æŒä¸‰ç§è§’è‰²ï¼š`GUEST`ã€`STAFF`ã€`ADMIN`
- âœ… æ³¨å†Œé€»è¾‘é»˜è®¤è®¾ç½® `userType = "GUEST"`ï¼ˆAuthService.java:63ï¼‰

#### 2. ç™»å½•è¿”å›è§’è‰²ä¿¡æ¯
- âœ… `LoginResponse.java` åŒ…å« `userType` å­—æ®µ
- âœ… ç™»å½•æ¥å£è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼š
  ```json
  {
    "accessToken": "eyJhbGciOiJIUzI1NiJ9...",
    "tokenType": "Bearer",
    "userId": 1,
    "userType": "GUEST",
    "username": "guest002",
    "memberLevel": "BRONZE",
    "currentPoints": 0
  }
  ```

#### 3. å‰ç«¯è·¯ç”±RBACæ”¹é€ 
- âœ… é‡æ„ `router/index.js`ï¼Œæ–°å¢ä¸‰å¥—è§’è‰²è·¯ç”±æ ‘ï¼š
  ```javascript
  /admin/*  - ä»…ADMINå¯è®¿é—®
  /staff/*  - ä»…STAFFå¯è®¿é—®
  /guest/*  - ä»…GUESTå¯è®¿é—®
  ```

- âœ… è·¯ç”±å…ƒä¿¡æ¯æ·»åŠ  `meta.roles` å­—æ®µï¼š
  ```javascript
  {
    path: '/admin/dashboard',
    meta: { 
      requiresAuth: true, 
      roles: ['ADMIN'] 
    }
  }
  ```

- âœ… å®ç° `router.beforeEach` å…¨å±€å®ˆå«ï¼š
  1. æ£€æŸ¥æ˜¯å¦ç™»å½•
  2. æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦åœ¨ `meta.roles` ä¸­
  3. æ— æƒé™æ—¶æç¤ºå¹¶é‡å®šå‘åˆ°å¯¹åº”è§’è‰²é¦–é¡µ

#### 4. ç™»å½•æµç¨‹ä¼˜åŒ–
- âœ… ä¿®æ”¹ `Login.vue` ç™»å½•æˆåŠŸé€»è¾‘ï¼š
  ```javascript
  // æ ¹æ®userTypeè‡ªåŠ¨è·³è½¬
  if (userType === 'ADMIN') router.push('/admin/dashboard')
  else if (userType === 'STAFF') router.push('/staff/workbench')
  else if (userType === 'GUEST') router.push('/guest/home')
  ```

- âœ… æ ¹è·¯å¾„ `/` é‡å®šå‘è§„åˆ™ï¼š
  ```javascript
  redirect: () => {
    const userType = userStore.userInfo?.userType
    if (userType === 'ADMIN') return '/admin/dashboard'
    if (userType === 'STAFF') return '/staff/workbench'
    return '/guest/home'
  }
  ```

#### 5. æµ‹è¯•è´¦å·åˆ›å»º
- âœ… ç¼–å†™SQLè„šæœ¬ï¼š`backend/src/main/resources/sql/insert_test_users_rbac.sql`
- âœ… åˆ›å»º5ä¸ªæµ‹è¯•è´¦å·ï¼ˆå¯†ç å‡ä¸º `123456`ï¼‰ï¼š

| æ‰‹æœºå·ï¼ˆç™»å½•ç”¨ï¼‰| è§’è‰²  | è¯´æ˜         |
|-----------------|-------|--------------|
| 13900000001     | ADMIN | é…’åº—ç®¡ç†å‘˜   |
| 13900000002     | STAFF | å‰å°å‘˜å·¥1    |
| 13900000003     | STAFF | å‰å°å‘˜å·¥2    |
| 13900000004     | GUEST | æµ‹è¯•ä½å®¢     |
| 13800138000     | GUEST | åŸæœ‰æµ‹è¯•è´¦å· |

- âœ… å·²å¯¼å…¥æ•°æ®åº“ï¼ŒéªŒè¯æˆåŠŸ

---

## ğŸ—ï¸ æ¶æ„å˜æ›´

### è·¯ç”±ç»“æ„å˜æ›´ï¼ˆå‰åå¯¹æ¯”ï¼‰

**å˜æ›´å‰**ï¼ˆå•è§’è‰²ï¼‰ï¼š
```
/ â†’ Dashboard (Layout)
â”œâ”€â”€ /dashboard â†’ Home
â”œâ”€â”€ /rooms â†’ RoomManagement
â””â”€â”€ /hardware â†’ HardwareMonitor
```

**å˜æ›´å**ï¼ˆå¤šè§’è‰²ï¼‰ï¼š
```
/
â”œâ”€â”€ /admin/* â†’ AdminLayout
â”‚   â””â”€â”€ /dashboard â†’ admin/Dashboard
â”œâ”€â”€ /staff/* â†’ StaffLayout
â”‚   â”œâ”€â”€ /workbench â†’ staff/Workbench
â”‚   â”œâ”€â”€ /rooms â†’ staff/RoomManagement
â”‚   â””â”€â”€ /hardware â†’ staff/HardwareMonitor â­ï¸
â””â”€â”€ /guest/* â†’ GuestLayout
    â”œâ”€â”€ /home â†’ guest/Home
    â””â”€â”€ /booking â†’ guest/Booking
```

### æƒé™å®ˆå«æµç¨‹

```
ç”¨æˆ·è®¿é—®å—ä¿æŠ¤é¡µé¢
    â†“
æ£€æŸ¥æ˜¯å¦ç™»å½• (isLoggedIn)
    â†“ å¦ â†’ è·³è½¬ /login?redirect=targetPath
    â†“ æ˜¯
æ£€æŸ¥è§’è‰²æƒé™ (meta.roles)
    â†“ ä¸åŒ¹é… â†’ æç¤ºé”™è¯¯ â†’ è·³è½¬åˆ°è§’è‰²é¦–é¡µ
    â†“ åŒ¹é…
å…è®¸è®¿é—®
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•è´¦å·å¿«é€Ÿç™»å½•

1. **ç®¡ç†å‘˜æµ‹è¯•**ï¼š
   - è´¦å·ï¼š13900000001
   - å¯†ç ï¼š123456
   - é¢„æœŸï¼šè·³è½¬ `/admin/dashboard`ï¼Œæ˜¾ç¤ºç®¡ç†çœ‹æ¿

2. **å‰å°å‘˜å·¥æµ‹è¯•**ï¼š
   - è´¦å·ï¼š13900000002
   - å¯†ç ï¼š123456
   - é¢„æœŸï¼šè·³è½¬ `/staff/workbench`ï¼Œæ˜¾ç¤ºå·¥ä½œå°

3. **ä½å®¢æµ‹è¯•**ï¼š
   - è´¦å·ï¼š13900000004
   - å¯†ç ï¼š123456
   - é¢„æœŸï¼šè·³è½¬ `/guest/home`ï¼Œæ˜¾ç¤ºä½å®¢é¦–é¡µ

### æƒé™å®ˆå«æµ‹è¯•

1. **è·¨è§’è‰²è®¿é—®æ‹¦æˆª**ï¼š
   - ç”¨ä½å®¢è´¦å·ç™»å½•
   - æ‰‹åŠ¨è®¿é—® `/admin/dashboard`
   - é¢„æœŸï¼šæç¤ºã€Œæ‚¨æ²¡æœ‰æƒé™è®¿é—®è¯¥é¡µé¢ã€ï¼Œè·³è½¬å› `/guest/home`

2. **æœªç™»å½•æ‹¦æˆª**ï¼š
   - æœªç™»å½•çŠ¶æ€è®¿é—® `/staff/rooms`
   - é¢„æœŸï¼šè·³è½¬åˆ° `/login?redirect=/staff/rooms`
   - ç™»å½•åè‡ªåŠ¨è·³è½¬å›ç›®æ ‡é¡µé¢

### æ–°æ³¨å†Œç”¨æˆ·æµ‹è¯•

1. æ³¨å†Œæ–°è´¦å·ï¼ˆæ‰‹æœºå·ï¼š13900000005ï¼‰
2. ç™»å½•åéªŒè¯æ˜¯å¦è·³è½¬åˆ° `/guest/home`ï¼ˆé»˜è®¤GUESTè§’è‰²ï¼‰

è¯¦ç»†æµ‹è¯•æŒ‡å—è¯·æŸ¥çœ‹ï¼š[RBAC_TEST_GUIDE.md](./RBAC_TEST_GUIDE.md)

---

## ğŸ“¦ ä»£ç æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶ï¼ˆ11ä¸ªï¼‰

**Layoutç»„ä»¶**ï¼š
- `frontend/src/layouts/AdminLayout.vue` (212 è¡Œ)
- `frontend/src/layouts/StaffLayout.vue` (215 è¡Œ)
- `frontend/src/layouts/GuestLayout.vue` (280 è¡Œ)

**è§’è‰²è§†å›¾**ï¼š
- `frontend/src/views/admin/Dashboard.vue` (169 è¡Œ)
- `frontend/src/views/guest/Home.vue` (176 è¡Œ)
- `frontend/src/views/guest/Booking.vue` (150 è¡Œ)

**ç§»åŠ¨æ–‡ä»¶**ï¼š
- `views/Home.vue` â†’ `views/staff/Workbench.vue`
- `views/RoomManagement.vue` â†’ `views/staff/RoomManagement.vue`
- `views/HardwareMonitor.vue` â†’ `views/staff/HardwareMonitor.vue` â­ï¸

**æ•°æ®åº“è„šæœ¬**ï¼š
- `backend/src/main/resources/sql/insert_test_users_rbac.sql` (50 è¡Œ)

**æ–‡æ¡£**ï¼š
- `RBAC_TEST_GUIDE.md` (æµ‹è¯•æŒ‡å—ï¼Œ460 è¡Œ)

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

- `frontend/src/router/index.js` (å®Œå…¨é‡æ„ï¼Œæ–°å¢RBACå®ˆå«)
- `frontend/src/views/Login.vue` (ä¿®æ”¹ç™»å½•æˆåŠŸåçš„è·³è½¬é€»è¾‘)

---

## ğŸš€ Dockeréƒ¨ç½²çŠ¶æ€

```bash
# å‰ç«¯å·²é‡æ–°æ„å»ºå¹¶é‡å¯
docker-compose build frontend
docker-compose restart frontend

# æ‰€æœ‰å®¹å™¨è¿è¡Œæ­£å¸¸
NAME                     STATUS
esports-hotel-backend    Up 3 minutes (healthy)
esports-hotel-frontend   Up 11 seconds
esports-hotel-mysql      Up 3 minutes (healthy)
esports-hotel-redis      Up 3 minutes (healthy)
```

å‰ç«¯è®¿é—®åœ°å€ï¼šhttp://localhost  
åç«¯APIåœ°å€ï¼šhttp://localhost:8080

---

## âš ï¸ é‡è¦è¯´æ˜

1. **åŸDashboard.vueå·²åºŸå¼ƒ**ï¼š
   - åŸ `views/Dashboard.vue` æ˜¯æ—§çš„å•è§’è‰²Layout
   - å·²è¢«ä¸‰å¥—æ–°Layoutæ›¿ä»£ï¼ˆAdminLayoutã€StaffLayoutã€GuestLayoutï¼‰
   - å»ºè®®åˆ é™¤è¯¥æ–‡ä»¶é¿å…æ··æ·†

2. **ç¡¬ä»¶ç›‘æ§ä»£ç å®Œæ•´ä¿ç•™**ï¼š
   - æ‰€æœ‰WebSocketè¿æ¥é€»è¾‘å·²å®Œæ•´è¿ç§»åˆ° `staff/HardwareMonitor.vue`
   - ä»£ç æ— ä»»ä½•åˆ å‡ï¼Œä»…è·¯å¾„å˜æ›´
   - ä»…å‰å°å‘˜å·¥ï¼ˆSTAFFï¼‰å¯è®¿é—®ï¼Œç¬¦åˆä¸šåŠ¡é€»è¾‘

3. **äºŒæ¬¡é‰´æƒåŠŸèƒ½å ä½**ï¼š
   - ä½å®¢ç«¯çš„POSã€ç¤¾äº¤ã€ç§¯åˆ†ç­‰åŠŸèƒ½å·²åœ¨Layoutä¾§è¾¹æ å ä½
   - æ˜¾ç¤ºä¸ºã€Œéœ€å…¥ä½ã€çŠ¶æ€ï¼Œç‚¹å‡»æç¤ºã€Œè¯·å…ˆå…¥ä½å¹¶ç»‘å®šæˆ¿é—´ã€
   - å®é™…åŠŸèƒ½å°†åœ¨ **Phase 2** å®ç°ï¼ˆæˆ¿é—´ç»‘å®šæœºåˆ¶ + RoomTokenï¼‰

4. **æ³¨å†Œé»˜è®¤è§’è‰²**ï¼š
   - æ‰€æœ‰é€šè¿‡æ³¨å†Œæ¥å£åˆ›å»ºçš„è´¦å·é»˜è®¤ä¸º `GUEST` è§’è‰²
   - `ADMIN` å’Œ `STAFF` è§’è‰²éœ€ç”±æ•°æ®åº“ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»º

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ–°å¢ä»£ç è¡Œæ•°**ï¼š~1,650 è¡Œï¼ˆåŒ…å«Layoutã€è§†å›¾ã€è·¯ç”±å®ˆå«ï¼‰
- **ä¿®æ”¹ä»£ç è¡Œæ•°**ï¼š~150 è¡Œï¼ˆLogin.vueã€router.jsï¼‰
- **åˆ é™¤ä»£ç è¡Œæ•°**ï¼š0 è¡Œï¼ˆæ— åˆ é™¤ï¼Œä»…ç§»åŠ¨ï¼‰
- **æµ‹è¯•è´¦å·æ•°é‡**ï¼š5 ä¸ªï¼ˆ1 ADMIN + 2 STAFF + 2 GUESTï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å¾…å¤„ç†ä»»åŠ¡

#### Phase 1 å‰©ä½™ä»»åŠ¡
- **ä»»åŠ¡1.3ï¼šä¿®å¤PMSçŠ¶æ€æœº**ï¼ˆå½“å‰ç³»ç»Ÿçš„æ ¸å¿ƒç¼ºé™·ï¼‰
  - é—®é¢˜ï¼šå…¥ä½è®°å½•ç»‘å®šåœ¨ `User` å®ä½“ä¸Šï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•å¤šæ¬¡å…¥ä½
  - è§£å†³æ–¹æ¡ˆï¼š
    1. ä¿®æ”¹å…¥ä½é€»è¾‘ï¼Œä½¿ç”¨ `CheckInRecord` ä½œä¸ºä¸»ä½“
    2. å®ç°æˆ¿é—´ç”Ÿå‘½å‘¨æœŸï¼š`VACANT â†’ OCCUPIED â†’ DIRTY â†’ VACANT`
    3. æ·»åŠ ã€Œæ¸…æ´å®Œæˆã€åŠŸèƒ½ï¼ˆå‰å°å‘˜å·¥æ“ä½œï¼‰
  - æ¶‰åŠæ–‡ä»¶ï¼š
    - åç«¯ï¼š`CheckInController.java`ã€`CheckInService.java`
    - å‰ç«¯ï¼š`staff/RoomManagement.vue`

#### Phase 2
- **äºŒæ¬¡é‰´æƒæœºåˆ¶**ï¼š
  - ä½å®¢ç™»å½•åéœ€ã€Œç»‘å®šæˆ¿é—´ã€è·å– `RoomToken`
  - `RoomToken` ä½œä¸ºæˆ¿å®¢æœåŠ¡ï¼ˆPOSã€ç¤¾äº¤ã€ç§¯åˆ†ï¼‰çš„é‰´æƒå‡­è¯
  - å‰ç«¯æ·»åŠ ã€Œç»‘å®šæˆ¿é—´ã€å¼¹çª—
  - åç«¯æ·»åŠ  `/api/guest/bind-room` æ¥å£

#### Phase 3
- **æ–°å¢å­ç³»ç»Ÿ**ï¼š
  - POSç³»ç»Ÿï¼ˆå•†åŸç‚¹é¤ï¼‰
  - ç¤¾äº¤åŒ¹é…ï¼ˆæ‰¾é˜Ÿå‹å¼€é»‘ï¼‰
  - ç§¯åˆ†ä»»åŠ¡ï¼ˆç­¾åˆ°ã€å®Œæˆä»»åŠ¡èµšç§¯åˆ†ï¼‰
  - æ™ºèƒ½æŠ¥è¡¨ï¼ˆLLMåˆ†æè¿è¥æ•°æ®ï¼‰

---

## âœ… ä»»åŠ¡1.1 & 1.2 éªŒæ”¶æ ‡å‡†

- [x] ä¸‰å¥—Layoutç»„ä»¶åˆ›å»ºå®Œæˆ
- [x] è§†å›¾ç›®å½•æŒ‰è§’è‰²é‡ç»„
- [x] ç¡¬ä»¶ç›‘æ§ä»£ç å·²ç§»åŠ¨åˆ°staffç›®å½•
- [x] è·¯ç”±æ·»åŠ RBACå®ˆå«
- [x] ç™»å½•æˆåŠŸåæ ¹æ®è§’è‰²è‡ªåŠ¨è·³è½¬
- [x] è·¨è§’è‰²è®¿é—®è¢«æ‹¦æˆª
- [x] æœªç™»å½•è®¿é—®è¢«æ‹¦æˆª
- [x] æ³¨å†Œé»˜è®¤è§’è‰²ä¸ºGUEST
- [x] æµ‹è¯•è´¦å·åˆ›å»ºå¹¶éªŒè¯æˆåŠŸ
- [x] Dockeré•œåƒé‡æ–°æ„å»ºå¹¶éƒ¨ç½²

**æ‰€æœ‰éªŒæ”¶æ ‡å‡†å‡å·²æ»¡è¶³ï¼âœ…**

---

**è¯·ç¡®è®¤ä»»åŠ¡1.1å’Œ1.2çš„å®Œæˆè´¨é‡ï¼Œç¡®è®¤æ— è¯¯åæˆ‘ä»¬å°†ç»§ç»­æ‰§è¡Œä»»åŠ¡1.3ï¼ˆPMSçŠ¶æ€æœºä¿®å¤ï¼‰ã€‚**

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è°ƒæ•´çš„åœ°æ–¹ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼
