# 前端启动指南

## 快速启动

### 1. 确保后端已启动
```bash
# 在 backend 目录下
mvn spring-boot:run
```
后端将在 http://localhost:8080 启动

### 2. 启动前端开发服务器
```bash
cd frontend
npm run dev
```
前端将在 http://localhost:5173 启动

### 3. 访问系统
打开浏览器访问：http://localhost:5173

## 测试账号

### 注册新用户
1. 点击"注册"标签
2. 输入手机号（格式：1xxxxxxxxxx）
3. 点击"获取验证码"（后端会在控制台打印验证码）
4. 填写其他信息并提交

### 测试流程

#### 1. 登录系统
- 使用注册的手机号和密码登录
- 登录成功后自动跳转到控制台

#### 2. 房态管理
- 点击左侧菜单"房态管理"
- 查看所有房间状态
- 选择一个"空闲"房间
- 点击"办理入住"按钮
- 填写入住信息并确认
- 入住成功后该房间状态变为"已入住"

#### 3. 硬件监控大屏
- 点击左侧菜单"硬件监控"
- 观察 WebSocket 连接状态（绿色脉动图标）
- 查看所有房间的硬件监控数据
- 数据每5秒自动更新
- 点击"触发故障"测试告警功能
- 点击"告警记录"查看所有告警

#### 4. 退出登录
- 点击右上角"退出登录"按钮
- 自动跳转回登录页

## 功能验证清单

### ✅ 用户认证
- [ ] 手机号格式验证
- [ ] 短信验证码发送（查看后端控制台）
- [ ] 密码强度验证
- [ ] 身份证号格式验证
- [ ] 注册成功提示
- [ ] 登录成功跳转
- [ ] Token 持久化（刷新页面不退出）

### ✅ 路由守卫
- [ ] 未登录访问受保护页面自动跳转登录
- [ ] 登录后跳转到原目标页面
- [ ] 页面标题动态更新

### ✅ 房态管理
- [ ] 显示所有房间
- [ ] 按状态筛选房间
- [ ] 房间卡片颜色根据状态变化
- [ ] 办理入住流程
- [ ] 办理退房流程
- [ ] 入住记录查询

### ✅ 硬件监控
- [ ] WebSocket 自动连接
- [ ] 连接状态实时显示
- [ ] 每5秒接收硬件数据推送
- [ ] 房间卡片颜色根据健康状态变化
- [ ] CPU/GPU 温度显示
- [ ] 网络延迟显示
- [ ] RED 状态房间脉动动画
- [ ] 触发故障功能
- [ ] 告警实时弹窗提示
- [ ] 告警记录管理
- [ ] 断线自动重连

## 技术亮点

### 1. 二次鉴权机制
- 普通 Token: 用于浏览系统各页面
- Room-Auth-Token: 入住成功后获得，用于房间控制权限
- 两层权限隔离，确保安全性

### 2. WebSocket 实时通信
- SockJS 提供 WebSocket 降级支持
- STOMP 协议实现发布/订阅模式
- 自动心跳检测和重连机制
- 优雅的连接状态指示

### 3. 响应式设计
- Grid 布局自适应屏幕尺寸
- 移动端友好的触摸交互
- 流畅的动画过渡效果

### 4. 统一错误处理
- Axios 拦截器统一处理 HTTP 错误
- Element Plus Message 全局提示
- 401 自动清除 Token 并跳转登录

## 开发工具

### 推荐 VS Code 扩展
- **Vue Language Features (Volar)**: Vue 3 语法高亮和智能提示
- **TypeScript Vue Plugin (Volar)**: TypeScript 支持
- **ESLint**: 代码规范检查
- **Prettier**: 代码格式化

### 浏览器开发工具
- **Vue Devtools**: 调试 Vue 组件状态
- **Network 标签**: 查看 API 请求
- **Console 标签**: 查看 WebSocket 消息

## 常见问题

### Q1: WebSocket 无法连接
**A**: 检查后端是否启动，确认 WebSocket 端点 `/api/ws` 可访问

### Q2: 验证码收不到
**A**: 查看后端控制台输出，验证码会打印在日志中（模拟发送）

### Q3: 401 未授权错误
**A**: Token 可能已过期，重新登录即可

### Q4: 房间状态不更新
**A**: 硬件监控页面的 WebSocket 更新房间状态，需先访问该页面

### Q5: 跨域问题
**A**: 已在 Vite 中配置代理，确保使用 `/api` 前缀访问后端

## 下一步开发建议

### 性能优化
- [ ] 使用 `<keep-alive>` 缓存页面状态
- [ ] 大列表使用虚拟滚动
- [ ] 图片懒加载
- [ ] 路由懒加载（已实现）

### 功能增强
- [ ] 房间设备控制（基于 Room-Auth-Token）
- [ ] 历史数据图表展示
- [ ] 实时聊天功能
- [ ] 消息通知系统

### 用户体验
- [ ] 加载状态骨架屏
- [ ] 操作确认二次弹窗
- [ ] 快捷键支持
- [ ] 深色模式

## 项目结构说明

```
frontend/
├── src/
│   ├── api/              # API 接口模块
│   │   ├── auth.js       # 认证相关
│   │   ├── room.js       # 房间管理
│   │   └── hardware.js   # 硬件监控
│   ├── stores/           # Pinia 状态管理
│   │   └── user.js       # 用户状态（Token、用户信息）
│   ├── router/           # 路由配置
│   │   └── index.js      # 路由定义和守卫
│   ├── utils/            # 工具函数
│   │   └── request.js    # Axios 封装
│   ├── views/            # 页面组件
│   │   ├── Login.vue            # 登录注册
│   │   ├── Dashboard.vue        # 控制台首页
│   │   ├── RoomManagement.vue   # 房态管理
│   │   ├── HardwareMonitor.vue  # 硬件监控
│   │   └── NotFound.vue         # 404
│   ├── App.vue           # 根组件
│   └── main.js           # 入口文件
└── vite.config.js        # Vite 配置（代理设置）
```

## 联调测试

### 测试场景1: 完整入住流程
1. 登录系统
2. 进入房态管理
3. 选择空闲房间办理入住
4. 验证 Room-Auth-Token 已保存（localStorage）
5. 进入硬件监控查看该房间状态变为 OCCUPIED
6. 办理退房
7. 验证 Room-Auth-Token 已清除

### 测试场景2: 硬件告警流程
1. 进入硬件监控页面
2. 确认 WebSocket 已连接
3. 点击某个房间的"触发故障"
4. 观察房间卡片变为 RED 状态
5. 收到告警弹窗提示
6. 点击"告警记录"查看详情
7. 处理告警

### 测试场景3: 实时监控
1. 打开两个浏览器窗口
2. 都登录并进入硬件监控页面
3. 在一个窗口触发故障
4. 观察另一个窗口也实时收到告警
5. 验证 WebSocket 广播功能

## 部署说明

### 开发环境
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```
构建产物在 `dist/` 目录

### 生产部署
1. 将 `dist/` 目录部署到 Nginx/Apache
2. 配置反向代理到后端 API
3. 配置 WebSocket 代理（`/api/ws`）

Nginx 配置示例：
```nginx
location /api/ {
    proxy_pass http://localhost:8080/api/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```
